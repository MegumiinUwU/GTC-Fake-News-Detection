<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Fake News Detector</title>
    <style>
      *, *::before, *::after { box-sizing: border-box; }
      :root[data-theme="dark"] {
        --bg: #0b1321;
        --card: #121b2c;
        --text: #e6edf3;
        --muted: #94a3b8;
        --primary: #4f46e5;
        --accent: #22c55e;
        --danger: #ef4444;
        --border: #22314e;
        --shadow: 0 6px 30px rgba(0,0,0,.35);
        --pill-bg: rgba(255,255,255,.08);
      }
      :root[data-theme="light"] {
        --bg: #f6f7fb;
        --card: #ffffff;
        --text: #0f172a;
        --muted: #475569;
        --primary: #4f46e5;
        --accent: #15803d;
        --danger: #b91c1c;
        --border: #e5e7eb;
        --pill-bg: rgba(0,0,0,.06);
        --shadow: 0 4px 18px rgba(0,0,0,.08);
      }
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background: var(--bg); color: var(--text); }
      .container { max-width: 900px; margin: 0 auto; padding: 24px 16px; }
      .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
      .title { font-size: 22px; font-weight: 700; }
      .toggle { background: var(--pill-bg); color: var(--text); border: 1px solid var(--border); border-radius: 10px; padding: 8px 12px; cursor: pointer; }

      .card { background: var(--card); border: 1px solid var(--border); border-radius: 14px; box-shadow: var(--shadow); overflow: hidden; }
      .card-body { padding: 16px; display: grid; gap: 12px; }
      label { font-size: 13px; color: var(--muted); }
      input[type="text"], textarea { width: 100%; background: transparent; color: var(--text); border: 1px solid var(--border); border-radius: 10px; padding: 10px 12px; font-size: 15px; display: block; }
      textarea { min-height: 180px; resize: vertical; }
      .actions { display: flex; align-items: center; gap: 12px; }
      .btn { background: var(--primary); color: #fff; border: none; border-radius: 10px; padding: 10px 16px; font-size: 15px; cursor: pointer; }
      .status { color: var(--muted); font-size: 13px; }

      .result { border-top: 1px solid var(--border); background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0)); padding: 14px 16px; display: none; }
      .row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
      .pill { display: inline-flex; align-items: center; gap: 8px; padding: 6px 10px; border-radius: 999px; background: var(--pill-bg); border: 1px solid var(--border); font-weight: 600; }
      .dot { width: 10px; height: 10px; border-radius: 999px; }
      .dot.real { background: var(--accent); box-shadow: 0 0 0 2px rgba(34,197,94,.15); }
      .dot.fake { background: var(--danger); box-shadow: 0 0 0 2px rgba(239,68,68,.15); }
      .meter { height: 12px; border-radius: 999px; background: rgba(148,163,184,.25); border: 1px solid var(--border); overflow: hidden; position: relative; }
      .meter-fill { height: 100%; width: 0%; transition: width .35s ease; background: linear-gradient(90deg, var(--danger), #f59e0b, var(--accent)); }
      .legend { display: flex; justify-content: space-between; font-size: 12px; color: var(--muted); }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="title">Fake News Detector</div>
        <button id="themeToggle" class="toggle" title="Toggle theme">Toggle Theme</button>
      </div>

      <div class="card">
        <div class="card-body">
          <div>
            <label>Title</label>
            <input id="title" type="text" placeholder="Optional title..." />
          </div>
          <div>
            <label>Body</label>
            <textarea id="text" placeholder="Paste the news content here..."></textarea>
          </div>
          <div class="actions">
            <button id="predict" class="btn">Predict</button>
            <span id="status" class="status"></span>
          </div>
        </div>
        <div id="result" class="result">
          <div class="row">
            <span id="pill" class="pill"><span id="pillDot" class="dot"></span><span id="pillText"></span></span>
            <span id="percent" style="font-variant-numeric: tabular-nums;"></span>
          </div>
          <div class="meter"><div id="meterFill" class="meter-fill"></div></div>
          <div class="legend"><span>Fake (0%)</span><span>Real (100%)</span></div>
        </div>
      </div>
    </div>

    <script>
      const btn = document.getElementById('predict');
      const result = document.getElementById('result');
      const statusEl = document.getElementById('status');
      const pill = document.getElementById('pill');
      const pillText = document.getElementById('pillText');
      const pillDot = document.getElementById('pillDot');
      const meterFill = document.getElementById('meterFill');
      const percentEl = document.getElementById('percent');
      const themeToggle = document.getElementById('themeToggle');

      // Simple theme toggle (persists in localStorage)
      const THEME_KEY = 'fn_theme';
      const setTheme = (mode) => {
        const clean = (mode === 'light') ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', clean);
        document.documentElement.style.colorScheme = clean;
        localStorage.setItem(THEME_KEY, clean);
      };
      themeToggle.addEventListener('click', () => {
        const current = localStorage.getItem(THEME_KEY) || 'dark';
        setTheme(current === 'dark' ? 'light' : 'dark');
      });
      // Initialize theme (default dark)
      setTheme(localStorage.getItem(THEME_KEY) || 'dark');

      btn.addEventListener('click', async () => {
        const title = document.getElementById('title').value;
        const text = document.getElementById('text').value;
        if (!title && !text) {
          alert('Please provide a title or some text.');
          return;
        }
        statusEl.textContent = 'Predicting...';
        result.style.display = 'none';

        const formData = new FormData();
        formData.append('title', title);
        formData.append('text', text);

        const resp = await fetch('/predict/', { method: 'POST', body: formData, headers: { 'X-CSRFToken': getCookie('csrftoken') } });
        const data = await resp.json();
        statusEl.textContent = '';
        const isReal = data.label === 1;
        const probaReal = Math.max(0, Math.min(1, Number(data.probability_real || 0)));
        const probaPct = (probaReal * 100).toFixed(1);

        pillText.textContent = isReal ? 'Real' : 'Fake';
        pillDot.className = 'dot ' + (isReal ? 'real' : 'fake');
        percentEl.textContent = (isReal ? 'Real' : 'Fake') + ' probability: ' + probaPct + '%';
        meterFill.style.width = probaPct + '%';

        result.style.display = 'block';
      });

      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
      }
    </script>
  </body>
  </html>


